delete from t_global_sql_variables;
INSERT INTO  `t_global_sql_variables` (`id`, `name`, `content`, `function_name`, `mysql_function`, `postgres_function`, `hive_function`, `hbase_function`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`) VALUES ('1', '时间戳转化为分钟', '时间戳转换为时分(HH:mm)', 'date_format', 'FROM_UNIXTIME(@, \"%H:%i\")', 'to_char(@,\'hh:MM\')', '', '', '0', '2020-01-09 15:44:05', '2020-01-09 15:44:08', '', '', b'01');
INSERT INTO  `t_global_sql_variables` (`id`, `name`, `content`, `function_name`, `mysql_function`, `postgres_function`, `hive_function`, `hbase_function`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`) VALUES ('2', 'float数据格式化', 'float格式化，保留两位小微', 'double_format', 'CAST(@ AS DECIMAL(20,2))', '', '', '', '0', '2020-01-09 15:46:11', '2020-01-09 15:46:14', '', '', b'01');
INSERT INTO  `t_global_sql_variables` (`id`, `name`, `content`, `function_name`, `mysql_function`, `postgres_function`, `hive_function`, `hbase_function`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`) VALUES ('3', '时间格式化为年月日', '时间格式化为年月日 yyyy-mm-dd', 'date_format_date', 'DATE_FORMAT(@, \"%Y-%m-%d\")', 'to_char(@, \'YYYY-MM-DD\')', '', '', '0', '2020-01-09 16:00:18', '2020-01-09 16:00:20', '', '', b'00');
INSERT INTO  `t_global_sql_variables` (`id`, `name`, `content`, `function_name`, `mysql_function`, `postgres_function`, `hive_function`, `hbase_function`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`) VALUES ('4', '获取10天的当前时间', '获取当前时间的10天前时间 ', 'date_sub_10', 'DATE_SUB(@, INTERVAL 10 DAY)', '@ - INTERVAL \'10 DAY\' ', '', '', '0', '2020-01-09 16:03:57', '2020-01-09 16:04:00', '', '', b'00');
INSERT INTO  `t_global_sql_variables` (`id`, `name`, `content`, `function_name`, `mysql_function`, `postgres_function`, `hive_function`, `hbase_function`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`) VALUES ('5', '格式化时间为 yyyy-MM-dd HH:mm:ss', '格式化时间为 yyyy-MM-dd HH:mm:ss', 'date_format_date_time', 'DATE_FORMAT(@, \"%Y-%m-%d %H:%i:%s\")', 'to_char(@,\'yyyy-MM-dd hh:MM:ss\')', '', '', '0', '2020-01-09 20:03:33', '2020-01-09 20:03:39', '', '', b'00');
INSERT INTO  `t_global_sql_variables` (`id`, `name`, `content`, `function_name`, `mysql_function`, `postgres_function`, `hive_function`, `hbase_function`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`) VALUES ('6', '时间戳转化为 年月日 时分秒', '时间戳转化为 年月日 时分秒', 'unixtime_format_date_time', 'FROM_UNIXTIME(@, \"%Y-%m-%d %H:%i:%s\")', 'to_char(@,\'yyyy-MM-dd hh:MM:ss\')', '', '', '0', '2020-01-12 17:53:34', '2020-01-12 17:53:37', '', '', b'00');
INSERT INTO  `t_global_sql_variables` (`id`, `name`, `content`, `function_name`, `mysql_function`, `postgres_function`, `hive_function`, `hbase_function`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`) VALUES ('7', '判断是否为空', '判断是否为空，如果不为空返回第一个参数，为空返回第二个参数', 'ifnull', 'IFNULL', 'COALESCE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);




delete from `t_task_detail` where id='102';
delete from `t_task_detail` where id='103';
delete from `t_task_detail` where id='105';
delete from `t_task_detail` where id='109';
delete from `t_task_detail` where id='110';
delete from `t_task_detail` where id='112';
delete from `t_task_detail` where id='116';
delete from `t_task_detail` where id='117';




INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('102', '1', '1', NULL, '注册会员与实名人数', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n	\'\' AS area,\r\n	tt.create_time AS date,\r\n	ttt.count AS pople,\r\n	tt.count AS rate\r\nFROM\r\n	(\r\n		SELECT\r\n			create_time,\r\n			count(1) count\r\n		FROM\r\n			(\r\n				SELECT\r\n					&{date_format_date(@create_time)} AS create_time\r\n				FROM\r\n					customer_info\r\n				WHERE\r\n					create_time >= &{date_sub_10(NOW())}\r\n				AND id_card IS NOT NULL\r\n				ORDER BY\r\n					&{date_format_date(@create_time)} ASC\r\n			) t\r\n		GROUP BY\r\n			create_time\r\n	) tt\r\nJOIN (\r\n	SELECT\r\n		create_time,\r\n		count(1) count\r\n	FROM\r\n		(\r\n			SELECT\r\n				&{date_format_date(@create_time)} AS create_time\r\n			FROM\r\n				customer_info\r\n			WHERE\r\n				create_time >= &{date_sub_10(NOW())}\r\n			ORDER BY\r\n				&{date_format_date(@create_time)} ASC\r\n		) tt\r\n	GROUP BY\r\n		create_time\r\n) ttt ON tt.create_time = ttt.create_time order by date asc ', '每分钟 1 ， 6 开始执行 注册会员与实名人数', '4', '', '0', '', NULL, 'gddata_vip_regist_and_certification', NULL, '1', '1', '3', '1', '2020-02-01 08:43:14', '2020-02-01 08:43:16', '', '', b'01', NULL, '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('103', '1', '1', NULL, '区县工会劳模分布', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n	out_table_1.name as stree ,\r\n	\'成都市\' as area,\r\n	shijlmrs,\r\n	shengjlmrs,\r\n	gjlmrs\r\nFROM\r\n	(\r\n		SELECT\r\n			t_district.name AS name,\r\n			count(1) shijlmrs\r\n		FROM\r\n			model_worker_info\r\n		JOIN t_district ON address LIKE CONCAT(\'%\', t_district.name, \'%\') and  t_district.name != \'成都市\'\r\n		WHERE\r\n			hornor LIKE \'%成都市%\'\r\n		GROUP BY\r\n			t_district.name\r\n	) out_table_1\r\nJOIN (\r\n	SELECT\r\n		t_district.name AS name,\r\n		count(1) shengjlmrs\r\n	FROM\r\n		model_worker_info\r\n	JOIN t_district ON address LIKE CONCAT(\'%\', t_district.name, \'%\') and  t_district.name != \'成都市\'\r\n	WHERE\r\n		hornor LIKE \'%四川省%\'\r\n	GROUP BY\r\n		t_district.name\r\n) out_table_2 ON out_table_2.name = out_table_1.name\r\nJOIN (\r\n	SELECT\r\n		t_district.name AS name,\r\n		count(1) gjlmrs\r\n	FROM\r\n		model_worker_info\r\n	JOIN t_district ON address LIKE CONCAT(\'%\', t_district.name, \'%\') and  t_district.name != \'成都市\'\r\n	WHERE\r\n		hornor LIKE \'%国%\'\r\n	GROUP BY\r\n		t_district.name\r\n) out_table_3 ON out_table_3.name = out_table_1.name', '区县工会劳模分布， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'gddata_nmgj_distribution', NULL, '1', '1', '3', '1', '2020-01-09 17:45:38', '2020-01-09 17:45:38', '', '', b'01', NULL, '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('105', '1', '1', NULL, '工会大屏，实时数据-6个card', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'select \r\n(select count(1) as memberSum from customer_info) as qsghzchy ,\r\n(select count(1) AS count from admin_organization) as qszzs,\r\n(select count(1) as workerCount  from model_worker_info) as nmhys,\r\n \'3526\' as cyghzchys,\r\n(select count(1)  from customer_info where create_time >= &{date_format_date(now())} ) as jrzchys,\r\n(select  number as createTime  from t_online_member_count ORDER BY _CREATE_TIME_ DESC limit 1) as zxhys,\r\n\'成都市\' as area \r\nfrom DUAL', '工会大屏，实时数据-6个card', '4', '', '0', '', NULL, 'ghdata_real_time_data', NULL, '1', '1', '3', '1', '2020-02-04 15:03:44', '2020-02-04 15:03:46', '', '', b'00', '36', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('109', '1', '1', NULL, '新增注册会员数', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n \'\' as area,\r\n	create_time  as date,\r\n	count(1) as pople_number\r\nFROM\r\n	(\r\n		SELECT\r\n			&{date_format_date(@create_time)} AS create_time,\r\n			labor_union_id labor_union_id\r\n		FROM\r\n			customer_info\r\n		WHERE\r\n			create_time >= &{date_sub_10(NOW())}\r\n	) b\r\nGROUP BY\r\n	create_time\r\nORDER BY\r\n	create_time ASC', '新增注册会员数， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_regist_vip_datas', NULL, '1', '1', '3', '1', '2020-01-09 16:07:50', '2020-01-09 16:07:48', '', '', b'01', NULL, '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('110', '1', '1', NULL, '区县工会消费数据', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n	DISTINCT stree,online,offine, area\r\nFROM\r\n	(\r\n		SELECT\r\n			&{ifnull(\r\n				out_tabale_1.pay_time,\r\n				out_table_2.pay_time\r\n			)} AS stree,\r\n			&{ifnull(out_tabale_1.cpCount, 0)} AS online,\r\n			&{ifnull(out_table_2.cpCount, 0)} AS offine,\'成都市\' as area\r\n		FROM\r\n			(\r\n				SELECT\r\n					&{date_format_date(@pay_time)} AS pay_time,\r\n					sum(amount) / 100 cpCount\r\n				FROM\r\n					pay_cashier_orders\r\n				WHERE\r\n					state = 2\r\n				AND pay_time IS NOT NULL\r\n				GROUP BY\r\n					&{date_format_date(@pay_time)}\r\n			) out_tabale_1\r\n		LEFT JOIN (\r\n			SELECT\r\n				&{date_format_date(@pay_time)} AS pay_time,\r\n				sum(total_money) / 100 cpCount\r\n			FROM\r\n				order_item\r\n			WHERE\r\n				(\r\n					order_status = 4\r\n					OR order_status = 7\r\n				)\r\n			GROUP BY\r\n				&{date_format_date(@pay_time)}\r\n		) out_table_2 ON out_table_2.pay_time = out_tabale_1.pay_time\r\n	) out_table_1_1\r\nUNION\r\n	(\r\n		SELECT\r\n			&{ifnull(\r\n				out_tabale_1.pay_time,\r\n				out_table_2.pay_time\r\n			)} AS stree,\r\n			&{ifnull(out_tabale_1.cpCount, 0)} AS online,\r\n			&{ifnull(out_table_2.cpCount, 0)} AS offine,\'成都市\' as area\r\n		FROM\r\n			(\r\n				SELECT\r\n					&{date_format_date(@pay_time)} AS pay_time,\r\n					sum(amount) / 100 cpCount\r\n				FROM\r\n					pay_cashier_orders\r\n				WHERE\r\n					state = 2\r\n				AND pay_time IS NOT NULL\r\n				GROUP BY\r\n					&{date_format_date(@pay_time)}\r\n			) out_tabale_1\r\n		RIGHT JOIN (\r\n			SELECT\r\n				&{date_format_date(@pay_time)} AS pay_time,\r\n				sum(total_money) / 100 cpCount\r\n			FROM\r\n				order_item\r\n			WHERE\r\n				(\r\n					order_status = 4\r\n					OR order_status = 7\r\n				)\r\n			GROUP BY\r\n				&{date_format_date(@pay_time)}\r\n		) out_table_2 ON out_table_2.pay_time = out_tabale_1.pay_time\r\n	) \r\nORDER BY stree desc', '区县工会消费数据， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_qxghxf_datas', NULL, '1', '1', '3', '1', '2020-01-09 18:22:57', '2020-01-09 18:22:57', '', '', b'01', '36', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('112', '1', '1', NULL, '工会数据大屏-实时数据', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'select \r\n(select count(1) as memberSum from customer_info) as qsghzchy ,\r\n(select count(1) as workerCount  from model_worker_info) as nmhys,\r\n(select count(id_card) as count from customer_info where id_card is not null) smrzhys,\r\n(select  number as createTime  from t_online_member_count ORDER BY \"_CREATE_TIME_\" DESC limit 1) as zxhys,\r\n\'成都市\' as area ', '工会数据大屏-实时数据， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_data_huizong', NULL, '1', '1', '3', '1', '2020-01-09 18:30:30', '2020-01-09 18:30:30', '', '', b'00', '36', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('116', '1', '1', NULL, '职工技能大赛类型分布', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n	skill_type,\r\n	sum(rate) AS rate\r\nFROM\r\n	(\r\n		SELECT\r\n			&{ifnull(\r\n				table1.type_work_name,\r\n				\'其他\'\r\n			)} AS skill_type,\r\n			&{ifnull(table1.cout, table2.cout)} AS rate\r\n		FROM\r\n			(\r\n				SELECT\r\n					type_work_name,\r\n					cout\r\n				FROM\r\n					(\r\n						SELECT\r\n							type_work_name,\r\n							count(1) AS cout\r\n						FROM\r\n							skills_match\r\n						WHERE\r\n							type_work_name IS NOT NULL\r\n						GROUP BY\r\n							type_work_name\r\n					) b\r\n				ORDER BY\r\n					cout DESC\r\n				LIMIT 8\r\n			) table1\r\n		RIGHT JOIN (\r\n			SELECT\r\n				type_work_name,\r\n				count(1) AS cout\r\n			FROM\r\n				skills_match\r\n			WHERE\r\n				type_work_name IS NOT NULL\r\n			GROUP BY\r\n				type_work_name\r\n		) table2 ON table2.type_work_name = table1.type_work_name\r\n	) out_table\r\nGROUP BY\r\n	skill_type', '职工技能大赛类型分布， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_skill_game_type', NULL, '1', '1', '3', '1', '2020-01-09 16:40:14', '2020-01-09 16:40:14', '', '', b'01', NULL, '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('117', '1', '1', NULL, '百万职工技能大赛报名情况', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n	union_name AS NAME,\r\n	type_work_name AS ssgh,\r\n	&{date_format_date(@match_begin_time)} AS start_time,\r\n	count(1) AS current_user_count\r\nFROM\r\n	(\r\n		SELECT\r\n			skills_match.union_name,\r\n			skills_match.type_work_name,\r\n			skills_match.match_begin_time\r\n		FROM\r\n			skills_match\r\n		JOIN skills_signup_person ON skills_signup_person.match_id = skills_match.id\r\n	) out_table_1\r\nGROUP BY\r\n	union_name,\r\n	type_work_name,\r\n	match_begin_time\r\nORDER BY\r\n	match_begin_time DESC', '百万职工技能大赛报名情况， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_skill_game_table', NULL, '1', '1', '3', '1', '2020-01-09 17:03:37', '2020-01-09 17:03:37', '', '', b'01', '36', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('118', '1', '1', NULL, '职工婚恋实时认证名单', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n	CONCAT(first_name, star) AS NAME,\r\n	gender AS sex,\r\n	CASE phone_length\r\nWHEN 0 THEN\r\n	\'\'\r\nELSE\r\n	CONCAT(\r\n		phone_first,\r\n		\'****\',\r\n		phone_end\r\n	)\r\nEND AS phone,\r\n &{date_format_date_time(@create_time)} AS authentication_time,\r\n is_accept\r\nFROM\r\n	(\r\n		SELECT\r\n			substring(enter_name FROM 1 FOR 1) AS first_name,\r\n			CASE LENGTH(enter_name) / 3\r\n		WHEN 1 THEN\r\n			\'*\'\r\n		WHEN 2 THEN\r\n			\'**\'\r\n		WHEN 3 THEN\r\n			\'***\'\r\n		END AS star,\r\n		LENGTH(enter_iphone) AS phone_length,\r\n		substring(enter_iphone FROM 1 FOR 3) AS phone_first,\r\n		substring(\r\n			enter_iphone\r\n			FROM\r\n				LENGTH(enter_iphone) - 3 FOR LENGTH(enter_iphone)\r\n		) AS phone_end,\r\n		create_time,\r\n		gender,\r\n		CASE examine_status\r\n	WHEN 0 THEN\r\n		\'待审核\'\r\n	WHEN 1 THEN\r\n		\'审核通过\'\r\n	WHEN 2 THEN\r\n		\'审核不通过\'\r\n	END AS is_accept\r\n	FROM\r\n		wedding_enter_name\r\n	ORDER BY\r\n		create_time DESC\r\n	) tmp', '职工婚恋实时认证名单， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_love_authentication', NULL, '1', '1', '3', '1', '2020-01-09 20:04:52', '2020-01-09 20:04:52', '', '', b'00', '36', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('119', '1', '1', NULL, '区县工会职工技能大赛分布', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n	in_table_1.union_name AS area,\r\n	in_table_1.count AS count\r\nFROM\r\n	(\r\n		SELECT\r\n			REPLACE (union_name, \'总工会\', \'\') AS union_name,\r\n			count(1) count\r\n		FROM\r\n			skills_match\r\n		GROUP BY\r\n			union_name\r\n	) in_table_1\r\nJOIN t_district ON in_table_1.union_name = t_district. NAME\r\nORDER BY\r\n	in_table_1.count DESC\r\nLIMIT 15', '区县工会职工技能大赛分布， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_skill_game_distribute', NULL, '1', '1', '3', '1', '2020-01-09 16:47:45', '2020-01-09 16:47:45', '', '', b'01', NULL, '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('121', '1', '1', NULL, '职工婚恋实时配对名单', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'select &{date_format_date_time(@match_time)}  as match_time, \r\nCONCAT(first_name,send_use_name_star) as send_use_name, \r\nCONCAT(send_user_phone_first, \'****\',end_send_phone ) as send_user_phone, \r\nCONCAT(first_recevid_user_name,recevid_user_name_star) as recevid_user_name,\r\nCONCAT(first_recevid_phone, \'****\',end_recevid_phone ) as recevid_user_phone\r\n from (\r\nSELECT\r\n	match_time,\r\n	substring(send_use_name FROM 1 FOR 1) AS first_name,\r\n	CASE send_use_name_length\r\nWHEN 1 THEN\r\n	\'*\'\r\nWHEN 2 THEN\r\n	\'**\'\r\nWHEN 3 THEN\r\n	\'***\'\r\nEND AS send_use_name_star,\r\n substring(send_user_phone FROM 1 FOR 3) AS send_user_phone_first,\r\n substring(\r\n	send_user_phone\r\n	FROM\r\n		send_user_phone_length - 4 FOR send_user_phone_length\r\n) AS end_send_phone,substring(recevid_user_name FROM 1 FOR 1) AS first_recevid_user_name,\r\n CASE recevid_user_name_length\r\nWHEN 1 THEN\r\n	\'*\'\r\nWHEN 2 THEN\r\n	\'**\'\r\nWHEN 3 THEN\r\n	\'***\'\r\nEND AS recevid_user_name_star,\r\n substring(\r\n	recevid_user_phone\r\n	FROM\r\n		1 FOR 3\r\n) AS first_recevid_phone,\r\n substring(\r\n	recevid_user_phone\r\n	FROM\r\n		recevid_user_phone_length - 4 FOR recevid_user_phone_length\r\n) AS end_recevid_phone\r\nFROM\r\n	(\r\n		SELECT DISTINCT\r\n			accept_time AS match_time,\r\n			out_table_3.enter_name AS send_use_name,\r\n			LENGTH(out_table_3.enter_name) / 3 - 1 AS send_use_name_length,\r\n			out_table_3.enter_iphone AS send_user_phone,\r\n			LENGTH(out_table_3.enter_iphone) AS send_user_phone_length,\r\n			out_table_2.enter_name AS recevid_user_name,\r\n			LENGTH(out_table_2.enter_name) / 3 - 1 AS recevid_user_name_length,\r\n			out_table_2.enter_iphone AS recevid_user_phone,\r\n			LENGTH(out_table_2.enter_iphone) AS recevid_user_phone_length\r\n		FROM\r\n			(\r\n				SELECT\r\n					initiator_user_id,\r\n					accept_user_id,\r\n					accept_time\r\n				FROM\r\n					wedding_safe_user_relation\r\n				WHERE\r\n					is_accept = 1\r\n			) out_table_1\r\n		JOIN (\r\n			SELECT\r\n				enter_name,\r\n				initiator_user_id,\r\n				enter_iphone\r\n			FROM\r\n				wedding_safe_user_relation\r\n			JOIN wedding_enter_name ON wedding_enter_name.app_user_id = wedding_safe_user_relation.initiator_user_id\r\n			WHERE\r\n				is_accept = 1\r\n		) out_table_2 ON out_table_2.initiator_user_id = out_table_1.initiator_user_id\r\n		JOIN (\r\n			SELECT\r\n				enter_name,\r\n				accept_user_id,\r\n				enter_iphone\r\n			FROM\r\n				wedding_safe_user_relation\r\n			JOIN wedding_enter_name ON wedding_enter_name.app_user_id = accept_user_id\r\n			WHERE\r\n				is_accept = 1\r\n		) out_table_3 ON out_table_3.accept_user_id = out_table_1.accept_user_id\r\n	) tmp_inner_table) tmp order by match_time desc', '职工婚恋实时配对名单， 每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'ghdata_match_info_list', NULL, '1', '1', '3', '1', '2020-01-10 10:14:05', '2020-01-10 10:14:05', '', '', b'00', '36', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('501', '1', '1', NULL, '服务器整体监控', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n table1.server_id AS service_id,\r\n round ( table1.VALUE, 2 ) AS cpu_usage,\r\n round ( table2.VALUE, 2 ) AS load_num,\r\n round ( table3.VALUE, 2 ) AS memory_usage,\r\n round ( table4.VALUE, 2 ) AS disk_usage,\r\n round ( table5.VALUE, 2 ) AS free_usage \r\nFROM\r\n (\r\n SELECT\r\n  endpoint AS server_id,\r\n  application AS application,\r\n  &{date_format(@create_time)} AS date_time,\r\n  counter,\r\n  VALUE \r\n FROM\r\n  wareahouse_open_falcon_src \r\n WHERE\r\n  \"_CREATE_TIME_\" = ( SELECT max( \"_CREATE_TIME_\" ) FROM wareahouse_open_falcon_src WHERE counter = \'cpu.user\'  ) \r\n  AND counter = \'cpu.user\' \r\n ) table1\r\n JOIN (\r\n SELECT\r\n  endpoint AS server_id,\r\n  application AS application,\r\n  &{date_format(@create_time)} AS date_time,\r\n  counter,\r\n  VALUE \r\n FROM\r\n  wareahouse_open_falcon_src \r\n WHERE\r\n  \"_CREATE_TIME_\" = ( SELECT max( \"_CREATE_TIME_\" ) FROM wareahouse_open_falcon_src WHERE counter = \'load.1min\' ) \r\n  AND counter =  \'load.1min\'  \r\n ) table2 ON table2.server_id = table1.server_id\r\n JOIN (\r\n SELECT\r\n  endpoint AS server_id,\r\n  application AS application,\r\n  &{date_format(@create_time)} AS date_time,\r\n  counter,\r\n  VALUE \r\n FROM\r\n  wareahouse_open_falcon_src \r\n WHERE\r\n  \"_CREATE_TIME_\" = ( SELECT max( \"_CREATE_TIME_\" ) FROM wareahouse_open_falcon_src WHERE  counter =  \'mem.memfree.percent\'  ) \r\n  AND counter =  \'mem.memfree.percent\' \r\n ) table3 ON table1.server_id = table3.server_id\r\n JOIN (\r\n SELECT\r\n  endpoint AS server_id,\r\n  application AS application,\r\n  &{date_format(@create_time)} AS date_time,\r\n  counter,\r\n  VALUE \r\n FROM\r\n  wareahouse_open_falcon_src \r\n WHERE\r\n  \"_CREATE_TIME_\" = ( SELECT max( \"_CREATE_TIME_\" ) FROM wareahouse_open_falcon_src WHERE counter =  \'df.statistics.used.percent\'  ) \r\n  AND counter =  \'df.statistics.used.percent\'  \r\n ) table4 ON table1.server_id = table4.server_id\r\n JOIN (\r\n SELECT\r\n  endpoint AS server_id,\r\n  application AS application,\r\n  &{date_format(@create_time)} AS date_time,\r\n  counter,\r\n  VALUE \r\n FROM\r\n  wareahouse_open_falcon_src \r\n WHERE\r\n  \"_CREATE_TIME_\" = ( SELECT max( \"_CREATE_TIME_\" ) FROM wareahouse_open_falcon_src WHERE counter = \'df.bytes.free.percent/fstype=xfs,mount=/\' ) \r\n  AND counter = \'df.bytes.free.percent/fstype=xfs,mount=/\'  \r\n ) table5 ON table1.server_id = table5.server_id\r\n AND table1.date_time = table2.date_time \r\n AND table1.date_time = table3.date_time \r\n AND table1.date_time = table4.date_time \r\n AND table1.date_time = table4.date_time;', '每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'service_essentials_monitor', NULL, '1', '1', '3', '1', '2019-12-20 16:17:16', '2019-12-20 16:17:16', '', '', b'01', '24', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('502', '1', '1', NULL, '服务器监控-内存使用率', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', 'SELECT\r\n table1.server_id AS service_id,\r\n table1.date_time AS date_time,\r\n round ( table1.VALUE, 2 ) AS memory_usage \r\nFROM\r\n (\r\n SELECT\r\n  endpoint AS server_id,\r\n  application AS application,\r\n  &{date_format(@create_time)} AS date_time,\r\n  counter,\r\n  VALUE \r\n FROM\r\n  wareahouse_open_falcon_src \r\n WHERE\r\n  \"_CREATE_TIME_\" = ( SELECT max( \"_CREATE_TIME_\" ) FROM wareahouse_open_falcon_src WHERE counter = \'mem.memfree.percent\'  ) \r\n AND counter = \'mem.memfree.percent\' \r\n ) table1', '每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'service_physics_memory_info', NULL, '1', '1', '3', '1', '2020-01-09 17:45:38', '2020-01-09 17:45:38', '', '', b'01', '24', '');
INSERT INTO `t_task_detail` (`id`, `subject_id`, `task_id`, `datasource_id`, `name`, `corn`, `exec_sql`, `content`, `task_type`, `schema_name`, `depend_task_id`, `source_table_name`, `source_source_id`, `target_table`, `target_source_id`, `cancel_exec`, `source_data_type`, `target_data_type`, `status`, `create_time`, `update_time`, `create_user`, `update_user`, `flag`, `hold_timeout`, `where_and`) VALUES ('504', '1', '1', NULL, '服务器监控-磁盘信息', '0 1,6,11,16,21,26,31,36,41,46,51,56 * * * ? ', ' SELECT\r\n table1.server_id AS service_id,\r\n table1.date_time AS date_time,\r\n round ( table1.VALUE, 2 ) AS disk_usage \r\nFROM\r\n (\r\n SELECT\r\n  endpoint AS server_id,\r\n  application AS application,\r\n  &{date_format(@create_time)} AS date_time,\r\n  counter,\r\n  VALUE\r\n FROM\r\n  wareahouse_open_falcon_src \r\n WHERE\r\n  \"_CREATE_TIME_\" = ( SELECT max( \"_CREATE_TIME_\" ) FROM wareahouse_open_falcon_src WHERE counter = \'df.statistics.used.percent\' ) \r\n AND counter = \'df.statistics.used.percent\'  \r\n ) table1', '每分钟 1 ， 6 开始执行', '4', '', '0', '', NULL, 'service_desk_info', NULL, '1', '1', '3', '1', '2020-01-09 17:45:38', '2020-01-09 17:45:38', '', '', b'01', '24', '');

